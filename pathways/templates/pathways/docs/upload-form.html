{% extends "pathways/snippets/question.html" %}
{% load i18n %}
{% load static %}

{% block question %}
<div class="form-card">
    {% for field in form.visible_fields %}
    <div class="form-card__header form-card__header--with-icon">
        <div class="form-card__icon emoji emoji--med emoji--money"></div>
        <h1 class="form-card__title margin-bottom--none" id="card_labelledby">{{ field.label }}</h1>
        <div class="form-card__body-text margin-bottom--none margin-top--medium" id="card_describedby">
            {{ field.help_text }}
            <br><br>
            {% trans "Accepted file types include <strong>.jpeg</strong>, <strong>.jpg</strong>, <strong>.png</strong>, <strong>.tiff</strong>, and <strong>.pdf</strong>." %}
        </div>
            {% if field.errors %}
            {% for error in field.errors %}
            <p class="text--error"><i class="icon-warning"></i>{{ error|escape }}</p>
            {% endfor %}
            {% endif %}
    </div>

    <div class="form-card__content">
        <div class="form-card__content">
            <div class="doc-preview-container">
                <div class="doc-preview" id="doc-preview-box" style="display: none;">
                    <div class="doc-preview__info">
                        <h2 class="form-card__subtitle with-padding-small">
                            <p id="preview-subtitle"></p>
                        </h2>
                    </div>
                    <div class="doc-preview__thumb">
                        <img id="doc-preview" alt="Preview image of your uploaded document"
                            src="#" width="100" height="100"/>
                    </div>
                    <br>
                </div>
            </div>

            <form class="{{field.name}}" enctype="multipart/form-data" method="post">
                {% csrf_token %}
                <div class="document-upload with-padding-med">
                    <div class="file-upload">

                        <label id="computer-photo-input" class="button is-tablet-hidden--inline" for="doc-input">
                            <i class="button__icon--left icon-file_upload"></i>
                            {% trans "Pick a file from this computer" %}
                        </label>

                        <label id="tablet-photo-input" class="button is-desktop-hidden--inline" for="doc-input">
                            <i class="button__icon--left icon-add_a_photo"></i>
                            {% trans "Take a picture" %}
                        </label>
                        <input type="file" name="{{field.name}}" id="doc-input" accept="image/*"
                            style="width: 0.1px; height: 0.1px; opacity: 0; overflow: hidden; position: absolute; z-index: -1;"
                            onchange="readURL(this)" required>
                    </div>
                </div>

                <button name="button" type="submit" class="button button--primary">{% trans "Upload" %}</button>
            </form>
        </div>
        <script>
            function readURL(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();

                    reader.onload = function (e) {
                        $('#doc-preview').attr('src', e.target.result);
                        $('#doc-preview-box').attr('style', "display: block;");
                        var filename = ($('#doc-input')[0].value).match(/[^\\/]*$/)[0];
                        $('#preview-subtitle').html(filename);
                    }

                    reader.readAsDataURL(input.files[0]);
                }
            }
        </script>
        {% endfor %}

        <div class="form-card__footer">
            <div class="toolbar">
                <div class="toolbar__left">
                    <a class="button" href="{{ next_url }}">{% trans "Nothing to submit now" %}</a>
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock question %}